{"version":3,"sources":["../../src/L_star/HTML_L_star.ts"],"names":["automatonDiv","clear_automaton_HTML","message","tableHTML","L_star","HTML_LStar","finish","constructor","alphabet","teacher","table_header","createTHead","table_body","createTBody","pile_actions","draw_table","add_row","undefined","E","fst","s","S","row","Array","from","observation_table","length","SA","parent","head","row_elts","colspan","rowspan","convert_to_epsilon","e","create_cell_with_text","txt","cell","insertCell","innerHTML","insertRow","style","borderTop","document","createElement","setAttribute","appendChild","letter","clear_table","graphic_next_step","shift","close_action","consistence_action","send_automaton_action","query_number","member_number","add_automaton_listener","input","setB","addEventListener","automaton","restart","initiate_graph","sendB","draw_next_step","value","slice","close_rep","is_close","innerText","push","add_elt_in_S","consistence_rep","is_consistent","new_col","find_suffix_not_compatible","s1","s2","a","add_column","make_automaton","answer","make_member","console","log"],"mappings":"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","sourcesContent":["import { Automaton } from \"../Automaton.js\";\r\nimport { automatonDiv, automatonHTML, clear_automaton_HTML, message, tableHTML } from \"../Main.js\";\r\nimport { Teacher } from \"../Teacher.js\";\r\nimport { myFunction } from \"../Utilities.js\";\r\nimport { L_star } from \"./L_star.js\";\r\n\r\nexport class HTML_LStar extends L_star {\r\n  table_header: HTMLTableSectionElement;\r\n  table_body: HTMLTableSectionElement;\r\n  pile_actions: myFunction<void, void>[];\r\n  automaton: Automaton | undefined;\r\n  finish = false;\r\n\r\n  constructor(alphabet: string, teacher: Teacher) {\r\n    super(alphabet, teacher);\r\n    this.table_header = tableHTML.createTHead();\r\n    this.table_body = tableHTML.createTBody();\r\n    this.pile_actions = [() => this.draw_table()];\r\n  }\r\n\r\n  draw_table() {\r\n    this.add_row(this.table_header, \"Table\", undefined, this.E, 2);\r\n\r\n    /**\r\n     The first {@link S}.length rows of the table start with the S symbol\r\n    */\r\n    var fst: string | undefined = \"S\";\r\n    for (var s of this.S) {\r\n      const row = Array.from(this.observation_table[s]);\r\n      this.add_row(this.table_body, fst, s, row, 1, fst ? this.S.length : 1);\r\n      fst = undefined;\r\n    }\r\n    /**\r\n     In the second part of the table, rows start with the SA symbol\r\n    */\r\n    var fst: string | undefined = \"SA\";\r\n    for (var s of this.SA) {\r\n      const row = Array.from(this.observation_table[s]);\r\n      this.add_row(this.table_body, fst, s, row, 1, fst ? this.SA.length : 1);\r\n      fst = undefined;\r\n    }\r\n  }\r\n\r\n  add_row(\r\n    parent: HTMLTableSectionElement, fst: string | undefined, head: string | undefined,\r\n    row_elts: string[], colspan: number = 1, rowspan: number = 1\r\n  ) {\r\n    let convert_to_epsilon = (e: string) => e == \"\" ? \"&epsilon;\" : e;\r\n    let create_cell_with_text = (row: HTMLTableRowElement, txt: string) => {\r\n      var cell = row.insertCell();\r\n      cell.innerHTML = `${convert_to_epsilon(txt)}`\r\n    };\r\n    // console.log(head ? conver_to_epsilon(head) : \"Not head\", row_elts);\r\n    var row = parent.insertRow();\r\n    if (fst) {\r\n      row.style.borderTop = \"2px solid #009879\";\r\n      var cell = document.createElement('th');\r\n      cell.setAttribute(\"rowspan\", rowspan + \"\");\r\n      cell.setAttribute(\"colspan\", colspan + \"\");\r\n      cell.innerHTML = convert_to_epsilon(fst);\r\n      row.appendChild(cell);\r\n    }\r\n    if (head != undefined) create_cell_with_text(row, head);\r\n    for (var letter of row_elts)\r\n      create_cell_with_text(row, letter)\r\n  }\r\n\r\n  clear_table() {\r\n    this.table_body.innerHTML = \"\";\r\n    this.table_header.innerHTML = \"\";\r\n  }\r\n\r\n  graphic_next_step() {\r\n    if (this.finish) {\r\n      if (message.innerHTML != \"\")\r\n        message.innerHTML = \"The Teacher has accepted the automaton\";\r\n    }\r\n    else if (this.pile_actions.length > 0) {\r\n      this.pile_actions.shift()!()\r\n    }\r\n    else if (!this.close_action()) { }\r\n    else if (!this.consistence_action()) { }\r\n    else this.send_automaton_action()\r\n    message.innerHTML =\r\n      `Queries = ${this.query_number} - Membership = ${this.member_number} <br>\r\n      ${message.innerHTML}`\r\n  }\r\n\r\n  private add_automaton_listener() {\r\n    let input = document.createElement(\"input\");\r\n    let setB = document.createElement(\"button\");\r\n    setB.innerHTML = \"Reinitialize automaton\";\r\n    setB.addEventListener('click', () => {\r\n      this.automaton!.restart();\r\n      this.automaton!.initiate_graph();\r\n    })\r\n    let sendB = document.createElement(\"button\")\r\n    sendB.innerHTML = \"Next char\";\r\n    sendB.addEventListener('click', () => {\r\n      this.automaton!.draw_next_step(input.value[0])\r\n      input.value = input.value.slice(1);\r\n    });\r\n    automatonDiv.appendChild(input);\r\n    automatonDiv.appendChild(sendB);\r\n    automatonDiv.appendChild(setB);\r\n  }\r\n\r\n  close_action(): boolean {\r\n    const close_rep = this.is_close();\r\n    if (close_rep != undefined) {\r\n      message.innerText =\r\n        `The table is not closed since\r\n        row(${close_rep}) = ${this.observation_table[close_rep]} but there is no s in S such that row(s) = ${this.observation_table[close_rep]};\r\n        I'm going to move ${close_rep} from SA to S`\r\n      this.pile_actions.push(() => {\r\n        message.innerText = \"\";\r\n        this.add_elt_in_S(close_rep);\r\n        this.clear_table();\r\n        this.draw_table();\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  consistence_action(): boolean {\r\n    const consistence_rep = this.is_consistent()\r\n    if (consistence_rep != undefined) {\r\n      let new_col = this.find_suffix_not_compatible(consistence_rep)\r\n      let s1 = consistence_rep[0];\r\n      let s2 = consistence_rep[1];\r\n      let a = consistence_rep[2];\r\n      message.innerText =\r\n        `The table is not consistent : \r\n        row(${s1 ? s1 : \"ε\"}) and row(${s2 ? s2 : \"ε\"}) have same value in S,\r\n        but their value is not the same if we add ${a} \r\n        row(${s1 + a}) != row(${s2 + a})\r\n        I'm going to add the column ${new_col} since T(${s1 + new_col}) != T(${s2 + new_col})`;\r\n      this.pile_actions.push(() => {\r\n        message.innerText = \"\";\r\n        this.add_column(new_col);\r\n        this.clear_table();\r\n        this.draw_table();\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  send_automaton_action() {\r\n    message.innerText =\r\n      `The table is consistent and closed, I will send an automaton`;\r\n    let automaton = this.make_automaton();\r\n\r\n    this.automaton = automaton;\r\n    this.pile_actions.push(() => {\r\n      message.innerHTML = \"\";\r\n      automaton.initiate_graph();\r\n      this.add_automaton_listener();\r\n      let answer = this.make_member(automaton);\r\n      if (answer != undefined) {\r\n        message.innerText =\r\n          `The sent automaton is not valid, \r\n          here is a counter-exemple ${answer}`;\r\n        this.pile_actions.push(() => {\r\n          message.innerHTML = \"\";\r\n          clear_automaton_HTML();\r\n          console.log(\"Adding\", answer, \"in S\");\r\n\r\n          this.add_elt_in_S(answer!);\r\n          this.clear_table();\r\n          this.draw_table();\r\n        })\r\n        return;\r\n      }\r\n      this.finish = true;\r\n    });\r\n  }\r\n}"],"file":"HTML_L_star.js"}