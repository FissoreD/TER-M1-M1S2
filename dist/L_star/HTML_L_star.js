import{automatonDiv,clear_automaton_HTML,message,tableHTML}from"../Main.js";import{L_star}from"./L_star.js";export class HTML_LStar extends L_star{finish=false;constructor(alphabet,teacher){super(alphabet,teacher);this.table_header=tableHTML.createTHead();this.table_body=tableHTML.createTBody();this.pile_actions=[()=>this.draw_table()]}draw_table(){this.add_row(this.table_header,"Table",undefined,this.E,2);var fst="S";for(var s of this.S){const row=Array.from(this.observation_table[s]);this.add_row(this.table_body,fst,s,row,1,fst?this.S.length:1);fst=undefined}var fst="SA";for(var s of this.SA){const row=Array.from(this.observation_table[s]);this.add_row(this.table_body,fst,s,row,1,fst?this.SA.length:1);fst=undefined}}add_row(parent,fst,head,row_elts,colspan=1,rowspan=1){let convert_to_epsilon=e=>e==""?"&epsilon;":e;let create_cell_with_text=(row,txt)=>{var cell=row.insertCell();cell.innerHTML=`${convert_to_epsilon(txt)}`};var row=parent.insertRow();if(fst){row.style.borderTop="2px solid #009879";var cell=document.createElement("th");cell.setAttribute("rowspan",rowspan+"");cell.setAttribute("colspan",colspan+"");cell.innerHTML=convert_to_epsilon(fst);row.appendChild(cell)}if(head!=undefined)create_cell_with_text(row,head);for(var letter of row_elts)create_cell_with_text(row,letter)}clear_table(){this.table_body.innerHTML="";this.table_header.innerHTML=""}graphic_next_step(){if(this.finish){if(message.innerHTML!="")message.innerHTML="The Teacher has accepted the automaton"}else if(this.pile_actions.length>0){this.pile_actions.shift()()}else if(!this.close_action()){}else if(!this.consistence_action()){}else this.send_automaton_action();message.innerHTML=`Queries = ${this.query_number} - Membership = ${this.member_number} <br>
      ${message.innerHTML}`}add_automaton_listener(){let input=document.createElement("input");let setB=document.createElement("button");setB.innerHTML="Reinitialize automaton";setB.addEventListener("click",()=>{this.automaton.restart();this.automaton.initiate_graph()});let sendB=document.createElement("button");sendB.innerHTML="Next char";sendB.addEventListener("click",()=>{this.automaton.draw_next_step(input.value[0]);input.value=input.value.slice(1)});automatonDiv.appendChild(input);automatonDiv.appendChild(sendB);automatonDiv.appendChild(setB)}close_action(){const close_rep=this.is_close();if(close_rep!=undefined){message.innerText=`The table is not closed since
        row(${close_rep}) = ${this.observation_table[close_rep]} but there is no s in S such that row(s) = ${this.observation_table[close_rep]};
        I'm going to move ${close_rep} from SA to S`;this.pile_actions.push(()=>{message.innerText="";this.add_elt_in_S(close_rep);this.clear_table();this.draw_table()});return false}return true}consistence_action(){const consistence_rep=this.is_consistent();if(consistence_rep!=undefined){let new_col=this.find_suffix_not_compatible(consistence_rep);let s1=consistence_rep[0];let s2=consistence_rep[1];let a=consistence_rep[2];message.innerText=`The table is not consistent : 
        row(${s1?s1:"\u03B5"}) and row(${s2?s2:"\u03B5"}) have same value in S,
        but their value is not the same if we add ${a} 
        row(${s1+a}) != row(${s2+a})
        I'm going to add the column ${new_col} since T(${s1+new_col}) != T(${s2+new_col})`;this.pile_actions.push(()=>{message.innerText="";this.add_column(new_col);this.clear_table();this.draw_table()});return false}return true}send_automaton_action(){message.innerText=`The table is consistent and closed, I will send an automaton`;let automaton=this.make_automaton();this.automaton=automaton;this.pile_actions.push(()=>{message.innerHTML="";automaton.initiate_graph();this.add_automaton_listener();let answer=this.make_member(automaton);if(answer!=undefined){message.innerText=`The sent automaton is not valid, 
          here is a counter-exemple ${answer}`;this.pile_actions.push(()=>{message.innerHTML="";clear_automaton_HTML();console.log("Adding",answer,"in S");this.add_elt_in_S(answer);this.clear_table();this.draw_table()});return}this.finish=true})}}
//# sourceMappingURL=HTML_L_star.js.map