{"version":3,"sources":["../../src/html_interactions/HTML_LernerBase.ts"],"names":["automatonDiv","clear_automaton_HTML","message","tableHTML","HTML_LernerBase","table_counter","constructor","lerner","table_header","createTHead","table_body","createTBody","pile_actions","draw_table","add_row_html","undefined","E","fst","s","S","row","Array","from","observation_table","length","SA","parent","head","row_elts","colspan","rowspan","convert_to_epsilon","e","create_cell_with_text","txt","cell","insertCell","innerHTML","insertRow","style","borderTop","document","createElement","setAttribute","appendChild","letter","clear_table","graphic_next_step","finish","shift","close_action","consistence_action","send_automaton_action","query_number","member_number","MathJax","typeset","close_rep","is_close","innerText","close_message","push","add_elt_in_S","consistence_rep","is_consistent","s1","s2","new_col","consistent_message","add_column","automaton","make_automaton","initiate_graph","add_automaton_listener","answer","make_member","table_to_update_after_equiv","input","setB","addEventListener","restart","nextB","draw_next_step","value","slice","acceptB","answerP","aut_answer","accept_word_nfa"],"mappings":"AAEA,OAASA,YAAT,CAAuBC,oBAAvB,CAA6CC,OAA7C,CAAsDC,SAAtD,KAAuE,YAAvE,CAGA,MAAO,MAAeC,CAAAA,eAA2C,CAO/DC,aAAa,CAAG,CAAH,CAEbC,WAAW,CAACC,MAAD,CAAiB,CAC1B,KAAKA,MAAL,CAAcA,MAAd,CAEA,KAAKC,YAAL,CAAoBL,SAAS,CAACM,WAAV,EAApB,CACA,KAAKC,UAAL,CAAkBP,SAAS,CAACQ,WAAV,EAAlB,CACA,KAAKC,YAAL,CAAoB,CAAC,IAAM,KAAKC,UAAL,EAAP,CACrB,CAEDA,UAAU,EAAG,CACX,KAAKC,YAAL,CAAkB,KAAKN,YAAvB,CAAqC,QAAU,KAAKH,aAAL,EAA/C,CAAqEU,SAArE,CAAgF,KAAKR,MAAL,CAAYS,CAA5F,CAA+F,CAA/F,EAKA,GAAIC,CAAAA,GAAuB,CAAG,GAA9B,CACA,IAAK,GAAIC,CAAAA,CAAT,GAAc,MAAKX,MAAL,CAAYY,CAA1B,CAA6B,CAC3B,KAAMC,CAAAA,GAAG,CAAGC,KAAK,CAACC,IAAN,CAAW,KAAKf,MAAL,CAAYgB,iBAAZ,CAA8BL,CAA9B,CAAX,CAAZ,CACA,KAAKJ,YAAL,CAAkB,KAAKJ,UAAvB,CAAmCO,GAAnC,CAAwCC,CAAxC,CAA2CE,GAA3C,CAAgD,CAAhD,CAAmDH,GAAG,CAAG,KAAKV,MAAL,CAAYY,CAAZ,CAAcK,MAAjB,CAA0B,CAAhF,EACAP,GAAG,CAAGF,SACP,CAID,GAAIE,CAAAA,GAAuB,CAAG,IAA9B,CACA,IAAK,GAAIC,CAAAA,CAAT,GAAc,MAAKX,MAAL,CAAYkB,EAA1B,CAA8B,CAC5B,KAAML,CAAAA,GAAG,CAAGC,KAAK,CAACC,IAAN,CAAW,KAAKf,MAAL,CAAYgB,iBAAZ,CAA8BL,CAA9B,CAAX,CAAZ,CACA,KAAKJ,YAAL,CAAkB,KAAKJ,UAAvB,CAAmCO,GAAnC,CAAwCC,CAAxC,CAA2CE,GAA3C,CAAgD,CAAhD,CAAmDH,GAAG,CAAG,KAAKV,MAAL,CAAYkB,EAAZ,CAAeD,MAAlB,CAA2B,CAAjF,EACAP,GAAG,CAAGF,SACP,CACF,CAEDD,YAAY,CACVY,MADU,CACuBT,GADvB,CACgDU,IADhD,CAEVC,QAFU,CAEUC,OAAe,CAAG,CAF5B,CAE+BC,OAAe,CAAG,CAFjD,CAGV,CACA,GAAIC,CAAAA,kBAAkB,CAAIC,CAAD,EAAeA,CAAC,EAAI,EAAL,CAAU,WAAV,CAAwBA,CAAhE,CACA,GAAIC,CAAAA,qBAAqB,CAAG,CAACb,GAAD,CAA2Bc,GAA3B,GAA2C,CACrE,GAAIC,CAAAA,IAAI,CAAGf,GAAG,CAACgB,UAAJ,EAAX,CACAD,IAAI,CAACE,SAAL,CAAkB,GAAEN,kBAAkB,CAACG,GAAD,CAAM,EAC7C,CAHD,CAKA,GAAId,CAAAA,GAAG,CAAGM,MAAM,CAACY,SAAP,EAAV,CACA,GAAIrB,GAAJ,CAAS,CACPG,GAAG,CAACmB,KAAJ,CAAUC,SAAV,CAAsB,mBAAtB,CACA,GAAIL,CAAAA,IAAI,CAAGM,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAX,CACAP,IAAI,CAACQ,YAAL,CAAkB,SAAlB,CAA6Bb,OAAO,CAAG,EAAvC,EACAK,IAAI,CAACQ,YAAL,CAAkB,SAAlB,CAA6Bd,OAAO,CAAG,EAAvC,EACAM,IAAI,CAACE,SAAL,CAAiBN,kBAAkB,CAACd,GAAD,CAAnC,CACAG,GAAG,CAACwB,WAAJ,CAAgBT,IAAhB,CACD,CACD,GAAIR,IAAI,EAAIZ,SAAZ,CAAuBkB,qBAAqB,CAACb,GAAD,CAAMO,IAAN,CAArB,CACvB,IAAK,GAAIkB,CAAAA,MAAT,GAAmBjB,CAAAA,QAAnB,CACEK,qBAAqB,CAACb,GAAD,CAAMyB,MAAN,CAArB,CACF,MAAOzB,CAAAA,GACR,CAED0B,WAAW,EAAG,CACZ,KAAKpC,UAAL,CAAgB2B,SAAhB,CAA4B,EAA5B,CACA,KAAK7B,YAAL,CAAkB6B,SAAlB,CAA8B,EAC/B,CAGDU,iBAAiB,EAAG,CAClB,GAAI,KAAKxC,MAAL,CAAYyC,MAAhB,CAAwB,CACtB,GAAI9C,OAAO,CAACmC,SAAR,EAAqB,EAAzB,CACEnC,OAAO,CAACmC,SAAR,CAAoB,wCACvB,CAHD,IAIK,IAAI,KAAKzB,YAAL,CAAkBY,MAAlB,CAA2B,CAA/B,CAAkC,CACrC,KAAKZ,YAAL,CAAkBqC,KAAlB,IACD,CAFI,IAGA,IAAI,CAAC,KAAKC,YAAL,EAAL,CAA0B,CAAG,CAA7B,IACA,IAAI,CAAC,KAAKC,kBAAL,EAAL,CAAgC,CAAG,CAAnC,IACA,MAAKC,qBAAL,GACLlD,OAAO,CAACmC,SAAR,CACG,aAAY,KAAK9B,MAAL,CAAY8C,YAAa,mBAAkB,KAAK9C,MAAL,CAAY+C,aAAc;AACxF,QAAQpD,OAAO,CAACmC,SAAU,EAFtB,CAIAkB,OAAO,CAACC,OAAR,EACD,CAEDN,YAAY,EAAY,CACtB,KAAMO,CAAAA,SAAS,CAAG,KAAKlD,MAAL,CAAYmD,QAAZ,EAAlB,CACA,GAAID,SAAS,EAAI1C,SAAjB,CAA4B,CAC1Bb,OAAO,CAACyD,SAAR,CACE,KAAKC,aAAL,CAAmBH,SAAnB,CADF,CAEA,KAAK7C,YAAL,CAAkBiD,IAAlB,CAAuB,IAAM,CAC3B3D,OAAO,CAACyD,SAAR,CAAoB,EAApB,CACA,KAAKpD,MAAL,CAAYuD,YAAZ,CAAyBL,SAAzB,EACA,KAAKX,WAAL,GACA,KAAKjC,UAAL,EACD,CALD,EAMA,MAAO,MACR,CACD,MAAO,KACR,CAEDsC,kBAAkB,EAAY,CAC5B,KAAMY,CAAAA,eAAe,CAAG,KAAKxD,MAAL,CAAYyD,aAAZ,EAAxB,CACA,GAAID,eAAe,EAAIhD,SAAvB,CAAkC,CAChC,GAAIkD,CAAAA,EAAE,CAAGF,eAAe,CAAC,CAAD,CAAxB,CACA,GAAIG,CAAAA,EAAE,CAAGH,eAAe,CAAC,CAAD,CAAxB,CACA,GAAII,CAAAA,OAAO,CAAGJ,eAAe,CAAC,CAAD,CAA7B,CACA7D,OAAO,CAACyD,SAAR,CAAoB,KAAKS,kBAAL,CAAwBH,EAAxB,CAA4BC,EAA5B,CAAgCC,OAAhC,CAApB,CACA,KAAKvD,YAAL,CAAkBiD,IAAlB,CAAuB,IAAM,CAC3B3D,OAAO,CAACyD,SAAR,CAAoB,EAApB,CACA,KAAKpD,MAAL,CAAY8D,UAAZ,CAAuBF,OAAvB,EACA,KAAKrB,WAAL,GACA,KAAKjC,UAAL,EACD,CALD,EAMA,MAAO,MACR,CACD,MAAO,KACR,CAEDuC,qBAAqB,EAAG,CACtBlD,OAAO,CAACyD,SAAR,CACG,8DADH,CAEA,GAAIW,CAAAA,SAAS,CAAG,KAAK/D,MAAL,CAAYgE,cAAZ,EAAhB,CAEA,KAAKD,SAAL,CAAiBA,SAAjB,CACA,KAAK1D,YAAL,CAAkBiD,IAAlB,CAAuB,IAAM,CAC3B3D,OAAO,CAACmC,SAAR,CAAoB,EAApB,CACAiC,SAAS,CAACE,cAAV,GACA,KAAKC,sBAAL,GACA,GAAIC,CAAAA,MAAM,CAAG,KAAKnE,MAAL,CAAYoE,WAAZ,CAAwBL,SAAxB,CAAb,CAGA,GAAII,MAAM,EAAI3D,SAAd,CAAyB,CACvBb,OAAO,CAACyD,SAAR,CACG;AACX,sCAAsCe,MAAO,EAFrC,CAGA,KAAK9D,YAAL,CAAkBiD,IAAlB,CAAuB,IAAM,CAC3B3D,OAAO,CAACmC,SAAR,CAAoB,EAApB,CACApC,oBAAoB,GACpB,KAAK2E,2BAAL,CAAiCF,MAAjC,EACA,KAAK5B,WAAL,GACA,KAAKjC,UAAL,EACD,CAND,EAOA,MACD,CACD,KAAKN,MAAL,CAAYyC,MAAZ,CAAqB,IACtB,CArBD,CAsBD,CAUDyB,sBAAsB,EAAG,CACvB,GAAII,CAAAA,KAAK,CAAGpC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAZ,CACA,GAAIoC,CAAAA,IAAI,CAAGrC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAX,CACAoC,IAAI,CAACzC,SAAL,CAAiB,wBAAjB,CACAyC,IAAI,CAACC,gBAAL,CAAsB,OAAtB,CAA+B,IAAM,CACnC,KAAKT,SAAL,CAAgBU,OAAhB,GACA,KAAKV,SAAL,CAAgBE,cAAhB,EACD,CAHD,EAIA,GAAIS,CAAAA,KAAK,CAAGxC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAZ,CACAuC,KAAK,CAAC5C,SAAN,CAAkB,WAAlB,CACA4C,KAAK,CAACF,gBAAN,CAAuB,OAAvB,CAAgC,IAAM,CACpC,KAAKT,SAAL,CAAgBY,cAAhB,CAA+BL,KAAK,CAACM,KAAN,CAAY,CAAZ,CAA/B,EACAN,KAAK,CAACM,KAAN,CAAcN,KAAK,CAACM,KAAN,CAAYC,KAAZ,CAAkB,CAAlB,CACf,CAHD,EAIApF,YAAY,CAAC4C,WAAb,CAAyBiC,KAAzB,EACA7E,YAAY,CAAC4C,WAAb,CAAyBqC,KAAzB,EACAjF,YAAY,CAAC4C,WAAb,CAAyBkC,IAAzB,EACA,GAAIO,CAAAA,OAAO,CAAG5C,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd,CACA,GAAI4C,CAAAA,OAAO,CAAG7C,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAd,CACA2C,OAAO,CAAChD,SAAR,CAAoB,cAApB,CACAgD,OAAO,CAACN,gBAAR,CAAyB,OAAzB,CAAkC,IAAM,CACtC,GAAIQ,CAAAA,UAAU,CAAG,KAAKjB,SAAL,EAAgBkB,eAAhB,CAAgCX,KAAK,CAACM,KAAtC,CAAjB,CACA,GAAII,UAAU,CAAE,CAAF,CAAd,CAAoB,CAClBD,OAAO,CAACjD,SAAR,CAAqB,YAAWwC,KAAK,CAACM,KAAM,wCAAuCI,UAAU,CAAE,CAAF,CAAK,EACnG,CAFD,IAEO,CACLD,OAAO,CAACjD,SAAR,CAAqB,6CAA4CwC,KAAK,CAACM,KAAM,EAC9E,CACF,CAPD,EAQAnF,YAAY,CAAC4C,WAAb,CAAyByC,OAAzB,EACArF,YAAY,CAAC4C,WAAb,CAAyB0C,OAAzB,CACD,CA/L8D","sourcesContent":["import { Automaton } from \"../automaton/Automaton.js\";\r\nimport { LernerBase } from \"../lerners/LernerBase.js\";\r\nimport { automatonDiv, clear_automaton_HTML, message, tableHTML } from \"../Main.js\";\r\nimport { myFunction } from \"../tools/Utilities.js\";\r\n\r\nexport abstract class HTML_LernerBase<Lerner extends LernerBase> {\r\n  lerner: Lerner;\r\n\r\n  table_header: HTMLTableSectionElement;\r\n  table_body: HTMLTableSectionElement;\r\n  pile_actions: myFunction<void, void>[];\r\n  automaton: Automaton | undefined;\r\n  table_counter = 0;\r\n\r\n  constructor(lerner: Lerner) {\r\n    this.lerner = lerner;\r\n\r\n    this.table_header = tableHTML.createTHead();\r\n    this.table_body = tableHTML.createTBody();\r\n    this.pile_actions = [() => this.draw_table()];\r\n  }\r\n\r\n  draw_table() {\r\n    this.add_row_html(this.table_header, \"Table\" + this.table_counter++, undefined, this.lerner.E, 2);\r\n\r\n    /**\r\n     The first {@link S}.length rows of the table start with the S symbol\r\n    */\r\n    var fst: string | undefined = \"S\";\r\n    for (var s of this.lerner.S) {\r\n      const row = Array.from(this.lerner.observation_table[s]);\r\n      this.add_row_html(this.table_body, fst, s, row, 1, fst ? this.lerner.S.length : 1);\r\n      fst = undefined;\r\n    }\r\n    /**\r\n     In the second part of the table, rows start with the SA symbol\r\n    */\r\n    var fst: string | undefined = \"SA\";\r\n    for (var s of this.lerner.SA) {\r\n      const row = Array.from(this.lerner.observation_table[s]);\r\n      this.add_row_html(this.table_body, fst, s, row, 1, fst ? this.lerner.SA.length : 1);\r\n      fst = undefined;\r\n    }\r\n  }\r\n\r\n  add_row_html(\r\n    parent: HTMLTableSectionElement, fst: string | undefined, head: string | undefined,\r\n    row_elts: string[], colspan: number = 1, rowspan: number = 1\r\n  ) {\r\n    let convert_to_epsilon = (e: string) => e == \"\" ? \"&epsilon;\" : e;\r\n    let create_cell_with_text = (row: HTMLTableRowElement, txt: string) => {\r\n      var cell = row.insertCell();\r\n      cell.innerHTML = `${convert_to_epsilon(txt)}`\r\n    };\r\n\r\n    var row = parent.insertRow();\r\n    if (fst) {\r\n      row.style.borderTop = \"2px solid #009879\";\r\n      var cell = document.createElement('th');\r\n      cell.setAttribute(\"rowspan\", rowspan + \"\");\r\n      cell.setAttribute(\"colspan\", colspan + \"\");\r\n      cell.innerHTML = convert_to_epsilon(fst);\r\n      row.appendChild(cell);\r\n    }\r\n    if (head != undefined) create_cell_with_text(row, head);\r\n    for (var letter of row_elts)\r\n      create_cell_with_text(row, letter)\r\n    return row;\r\n  }\r\n\r\n  clear_table() {\r\n    this.table_body.innerHTML = \"\";\r\n    this.table_header.innerHTML = \"\";\r\n  }\r\n\r\n\r\n  graphic_next_step() {\r\n    if (this.lerner.finish) {\r\n      if (message.innerHTML != \"\")\r\n        message.innerHTML = \"The Teacher has accepted the automaton\";\r\n    }\r\n    else if (this.pile_actions.length > 0) {\r\n      this.pile_actions.shift()!()\r\n    }\r\n    else if (!this.close_action()) { }\r\n    else if (!this.consistence_action()) { }\r\n    else this.send_automaton_action()\r\n    message.innerHTML =\r\n      `Queries = ${this.lerner.query_number} - Membership = ${this.lerner.member_number} <br>\r\n      ${message.innerHTML}`\r\n    // @ts-ignore\r\n    MathJax.typeset()\r\n  }\r\n\r\n  close_action(): boolean {\r\n    const close_rep = this.lerner.is_close();\r\n    if (close_rep != undefined) {\r\n      message.innerText =\r\n        this.close_message(close_rep);\r\n      this.pile_actions.push(() => {\r\n        message.innerText = \"\";\r\n        this.lerner.add_elt_in_S(close_rep);\r\n        this.clear_table();\r\n        this.draw_table();\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  consistence_action(): boolean {\r\n    const consistence_rep = this.lerner.is_consistent()\r\n    if (consistence_rep != undefined) {\r\n      let s1 = consistence_rep[0];\r\n      let s2 = consistence_rep[1];\r\n      let new_col = consistence_rep[2]\r\n      message.innerText = this.consistent_message(s1, s2, new_col);\r\n      this.pile_actions.push(() => {\r\n        message.innerText = \"\";\r\n        this.lerner.add_column(new_col);\r\n        this.clear_table();\r\n        this.draw_table();\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  send_automaton_action() {\r\n    message.innerText =\r\n      `The table is consistent and closed, I will send an automaton`;\r\n    let automaton = this.lerner.make_automaton();\r\n\r\n    this.automaton = automaton;\r\n    this.pile_actions.push(() => {\r\n      message.innerHTML = \"\";\r\n      automaton.initiate_graph();\r\n      this.add_automaton_listener();\r\n      let answer = this.lerner.make_member(automaton);\r\n\r\n\r\n      if (answer != undefined) {\r\n        message.innerText =\r\n          `The sent automaton is not valid, \r\n          here is a counter-exemple ${answer}`;\r\n        this.pile_actions.push(() => {\r\n          message.innerHTML = \"\";\r\n          clear_automaton_HTML();\r\n          this.table_to_update_after_equiv(answer!)\r\n          this.clear_table();\r\n          this.draw_table();\r\n        })\r\n        return;\r\n      }\r\n      this.lerner.finish = true;\r\n    });\r\n  }\r\n\r\n  abstract close_message(close_rep: string): string;\r\n\r\n  abstract consistent_message(s1: string, s2: string, new_col: string): string;\r\n\r\n  // abstract add_automaton_listener(): void;\r\n\r\n  abstract table_to_update_after_equiv(answer: string): void;\r\n\r\n  add_automaton_listener() {\r\n    let input = document.createElement(\"input\");\r\n    let setB = document.createElement(\"button\");\r\n    setB.innerHTML = \"Reinitialize automaton\";\r\n    setB.addEventListener('click', () => {\r\n      this.automaton!.restart();\r\n      this.automaton!.initiate_graph();\r\n    })\r\n    let nextB = document.createElement(\"button\")\r\n    nextB.innerHTML = \"Next char\";\r\n    nextB.addEventListener('click', () => {\r\n      this.automaton!.draw_next_step(input.value[0])\r\n      input.value = input.value.slice(1);\r\n    });\r\n    automatonDiv.appendChild(input);\r\n    automatonDiv.appendChild(nextB);\r\n    automatonDiv.appendChild(setB);\r\n    let acceptB = document.createElement(\"button\");\r\n    let answerP = document.createElement(\"p\");\r\n    acceptB.innerHTML = \"In automaton\";\r\n    acceptB.addEventListener(\"click\", () => {\r\n      let aut_answer = this.automaton?.accept_word_nfa(input.value);\r\n      if (aut_answer![0]) {\r\n        answerP.innerHTML = `The word ${input.value} is accepted, here is a valid path : ${aut_answer![1]}`\r\n      } else {\r\n        answerP.innerHTML = `There is no valid path accepting the word ${input.value}`\r\n      }\r\n    })\r\n    automatonDiv.appendChild(acceptB);\r\n    automatonDiv.appendChild(answerP);\r\n  }\r\n\r\n}"],"file":"HTML_LernerBase.js"}